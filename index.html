<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GVRM Avatar - A-Frame</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
</head>
<body>
  <a-scene background="color: #222">
    <a-entity camera position="0 1.6 3" look-controls></a-entity>
    <a-entity light="type: directional; intensity: 1" position="1 2 1"></a-entity>
    
    <!-- Avatar container -->
    <a-entity id="avatar" position="0 0 -2" rotation="0 180 0">
      <a-animation attribute="rotation" to="0 360 0" dur="10000" repeat="indefinite"></a-animation>
    </a-entity>
    
    <a-plane position="0 0 -3" rotation="-90 0 0" width="10" height="10" material="color: #444"></a-plane>
  </a-scene>

  <!-- Load GVRM AFTER scene (exact timing from working examples) -->
  <script src="https://naruya.github.io/gs-edit/lib/gaussian-vrm.min.js"></script>
  
  <script>
    // EXACT copy of gaussian-vrm Three.js example pattern for A-Frame
    document.addEventListener('DOMContentLoaded', async () => {
      // Wait for A-Frame scene AND GVRM script to load
      await new Promise(resolve => {
        const check = () => {
          if (document.querySelector('a-scene') && typeof GVRM !== 'undefined') {
            resolve();
          } else {
            requestAnimationFrame(check);
          }
        };
        check();
      });

      const sceneEl = document.querySelector('a-scene');
      await new Promise(r => sceneEl.addEventListener('loaded', r));

      const scene = sceneEl.object3D;
      const camera = sceneEl.camera;
      const renderer = sceneEl.renderer;
      const avatarEl = document.getElementById('avatar');

      try {
        console.log('üîÑ Loading ./sample.gvrm...');
        
        // EXACT GVRM.load() call from gaussian-vrm examples
        const gvrm = await GVRM.load('./sample.gvrm', scene, camera, renderer);
        
        console.log('üîÑ Loading ./Idle.fbx animation...');
        // EXACT FBX animation call from examples
        await gvrm.changeFBX('./Idle.fbx');
        
        // Attach to A-Frame entity
        const vrmScene = gvrm.character.currentVrm.scene;
        vrmScene.scale.setScalar(1.0);
        avatarEl.object3D.add(vrmScene);
        
        // EXACT render loop from gaussian-vrm examples
        renderer.setAnimationLoop(() => {
          gvrm.update();
        });

        console.log('‚úÖ GVRM avatar LOADED! Check spinning avatar.');
        
      } catch (error) {
        console.error('‚ùå ERROR:', error);
        console.error('üìÅ Verify sample.gvrm and Idle.fbx are in repo root');
        console.error('üåê Test URLs:');
        console.error('   https://YOURUSERNAME.github.io/YOUR-REPO/sample.gvrm');
        console.error('   https://YOURUSERNAME.github.io/YOUR-REPO/Idle.fbx');
      }
    });
  </script>
</body>
</html>
